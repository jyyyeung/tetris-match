<!DOCTYPE html>
<html>

<head>
    <title>Tetris Match</title>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Stylesheets -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Chatroom container -->
    <div id="container" class="col">
        <div id="header" class="row">
            <div id="title">The Chatroom
                <span class="material-icons">chat</span>
            </div>

            <div class="spacer-grow"></div>

            <div id="user-panel" class="row">
                <div class="field-content row shadow">
                    <span class="user-avatar"></span>
                    <span class="user-name">-</span>
                </div>
                <button id="signout-button" class="icon"><span class="material-icons">logout</span></button>
            </div>
        </div>

        <div id="main-panel" class="row">
            <div id="chat-panel" class="col">
                <div id="chat-area" class="col"></div>
                <i>
                    <div id="show-typing"></div>
                </i>
                <form id="chat-input-form" autocomplete="off">
                    <input id="chat-input" placeholder="Enter your message"></input>
                </form>
            </div>

            <div id="online-users-panel" class="col">
                <div id="online-users-area" class="col"></div>
            </div>
        </div>
    </div>

    <div id="signin-overlay" class="overlay row">
        <div class="content shadow row">
            <form id="signin-form" class="col">
                <div class="caption">SIGN IN WITH YOUR ACCOUNT</div>
                <div class="spacer-0"></div>
                <input id="signin-username" placeholder="Enter your username"></input>
                <input id="signin-password" type="password" placeholder="Enter your password"></input>
                <div class="spacer-0"></div>
                <button type="submit">Sign In</button>
                <div id="signin-message" class="warning center"></div>
                <div class="spacer-grow"></div>
            </form>

            <div class="spacer-0"></div>

            <form id="register-form" class="col">
                <div class="caption">OR, REGISTER IF YOU DO NOT HAVE ONE</div>
                <div class="spacer-0"></div>
                <input id="register-username" maxlength="10" placeholder="Enter your username"></input>
                <select id="register-avatar">
                    <option value="">Select your avatar</option>
                </select>
                <input id="register-name" maxlength="16" placeholder="Enter your name"></input>
                <input id="register-password" type="password" placeholder="Enter your password"></input>
                <input id="register-confirm" type="password" placeholder="Enter your password again"></input>
                <div class="spacer-0"></div>
                <button type="submit">Register</button>
                <div id="register-message" class="warning center"></div>
            </form>
        </div>

        <!-- GEM Rush game container -->
        <div id="game-container">
            <!-- <canvas width="854px" height="480px"></canvas> -->
            <!-- Game Start Display text -->
            <!-- <svg xmlns="http://www.w3.org/2000/svg" id="game-start">
                <defs>
                    <linearGradient id="title-fill" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0.2" stop-color="red" />
                        <stop offset="0.4" stop-color="yellow" />
                        <stop offset="0.6" stop-color="green" />
                        <stop offset="0.8" stop-color="purple" />
                    </linearGradient>
                </defs>
                <text id="game-title" x="50%" y="45%">GEM RUSH!</text>
                <text x="50%" y="60%">Click here to start the game</text>
            </svg> -->

            <!-- Game over display text -->
            <!-- <svg xmlns="http://www.w3.org/2000/svg" id="game-over" style="display: none">
                <defs>
                    <linearGradient id="game-over-fill" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0" stop-color="red" />
                        <stop offset="0.5" stop-color="yellow" />
                        <stop offset="1" stop-color="red" />
                    </linearGradient>
                </defs>
                <text x="50%" y="50%">
                    Time's up! You have collected
                    <tspan id="final-gems">0</tspan>
                    gem(s).
                </text>
            </svg> -->
        </div>
    </div>

    <script src="/socket.io/socket.io.min.js"></script>
    <script src="scripts/socket.js"></script>
    <script src="scripts/avatar.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/registration.js"></script>
    <script src="scripts/authentication.js"></script>


    <script>
        $(function () {
            // Initialize the UI
            UI.initialize();

            // Validate the signin
            Authentication.validate(
                () => {
                    SignInForm.hide();
                    UserPanel.update(Authentication.getUser());
                    UserPanel.show();

                    Socket.connect();
                },
                () => { SignInForm.show(); }
            );
        });
    </script>

    <script src="scripts/bounding_box.js"></script>
    <script src="scripts/sprites/sprite.js"></script>
    <script src="scripts/sprites/gem.js"></script>

    <!-- <script>
            $(function () {
                /* Get the canvas and 2D context */
                const cv = $("canvas").get(0);
                const context = cv.getContext("2d");

                /* Create the sounds */
                const sounds = {
                    background: new Audio("background.mp3"),
                    collect: new Audio("collect.mp3"),
                    gameover: new Audio("gameover.mp3"),
                };

                const totalGameTime = 20; // Total game time in seconds
                const gemMaxAge = 3000; // The maximum age of the gems in milliseconds
                let gameStartTime = 0; // The timestamp when the game starts
                let collectedGems = 0; // The number of gems collected in the game

                /* Create the game area */
                const gameArea = BoundingBox(context, 165, 60, 420, 800);

                /* Create the sprites in the game */
                const player = Player(context, 427, 240, gameArea); // The player
                const gem = Gem(context, 427, 350, "green"); // The gem

                // Create the fires
                gameAreaPoints = gameArea.getPoints();
                const fires = [
                    Fire(
                        context,
                        gameAreaPoints.topLeft[0],
                        gameAreaPoints.topLeft[1]
                    ),
                    Fire(
                        context,
                        gameAreaPoints.topRight[0],
                        gameAreaPoints.topRight[1]
                    ),
                    Fire(
                        context,
                        gameAreaPoints.bottomLeft[0],
                        gameAreaPoints.bottomLeft[1]
                    ),
                    Fire(
                        context,
                        gameAreaPoints.bottomRight[0],
                        gameAreaPoints.bottomRight[1]
                    ),
                ];

                /* The main processing of the game */
                function doFrame(now) {
                    if (gameStartTime == 0) gameStartTime = now;

                    /* Update the time remaining */
                    const gameTimeSoFar = now - gameStartTime;
                    const timeRemaining = Math.ceil(
                        (totalGameTime * 1000 - gameTimeSoFar) / 1000
                    );
                    $("#time-remaining").text(timeRemaining);

                    /* XXX: Handle the game over situation here */
                    if (timeRemaining == 0) {
                        $("#final-gems").text(collectedGems);
                        sounds.background.pause();
                        sounds.collect.pause();
                        sounds.gameover.play();
                        $("#game-over").show();
                        return;
                    }

                    /* Update the sprites */
                    gem.update(now);
                    player.update(now);
                    fires.forEach((fire) => {
                        fire.update(now);
                    });

                    /* XXX: Randomize the gem and collect the gem here */
                    if (gem.getAge(now) >= gemMaxAge) {
                        gem.randomize(gameArea);
                    }

                    playerBox = player.getBoundingBox();
                    gemLoc = gem.getXY();
                    if (playerBox.isPointInBox(gemLoc.x, gemLoc.y)) {
                        // Player touched gem
                        sounds.collect.currentTime = 0;
                        sounds.collect.play();
                        collectedGems++;
                        gem.randomize(gameArea);
                    }

                    /* Clear the screen */
                    context.clearRect(0, 0, cv.width, cv.height);

                    /* Draw the sprites */
                    gem.draw();
                    player.draw();
                    fires.forEach((fire) => {
                        fire.draw();
                    });

                    /* Process the next frame */
                    requestAnimationFrame(doFrame);
                }

                // MOVEMENTS
                const MOVE_LEFT = 1;
                const MOVE_UP = 2;
                const MOVE_RIGHT = 3;
                const MOVE_DOWN = 4;
                const MOVEMENTS = [MOVE_LEFT, MOVE_UP, MOVE_RIGHT, MOVE_DOWN];

                // SPEED
                const SPEED_CHANGE = 5;

                function action_from_key(key) {
                    const SPACEBAR = 32;
                    const LEFT_KEY = 37;
                    const UP_KEY = 38;
                    const RIGHT_KEY = 39;
                    const DOWN_KEY = 40;

                    if (key == LEFT_KEY) return MOVE_LEFT;
                    if (key == UP_KEY) return MOVE_UP;
                    if (key == RIGHT_KEY) return MOVE_RIGHT;
                    if (key == DOWN_KEY) return MOVE_DOWN;
                    if (key == SPACEBAR) return SPEED_CHANGE;
                    return 0;
                }

                /* Handle the start of the game */
                $("#game-start").on("click", function () {
                    /* Hide the start screen */
                    $("#game-start").hide();

                    // Play Packground music
                    sounds.background.play();

                    // Randomize Gem location and color
                    gem.randomize(gameArea);

                    /* Handle the keydown of arrow keys and spacebar */
                    $(document).on("keydown", function (event) {
                        action = action_from_key(event.keyCode);

                        // Invalid Action
                        if (action <= 0) return;
                        // Action is movement
                        if (MOVEMENTS.includes(action)) player.move(action);
                        // Action is speed change
                        if (action == SPEED_CHANGE) player.speedUp();
                    });

                    /* Handle the keyup of arrow keys and spacebar */
                    $(document).on("keyup", function (event) {
                        action = action_from_key(event.keyCode);

                        // Invalid Action
                        if (action <= 0) return;
                        // Action is movement
                        if (MOVEMENTS.includes(action)) player.stop(action);
                        // Action is speed change
                        if (action == SPEED_CHANGE) player.slowDown();
                    });

                    /* Start the game */
                    requestAnimationFrame(doFrame);
                });
            });
        </script> -->
</body>

</html>
